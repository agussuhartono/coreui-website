const form=document.getElementById('form');let supportActive,supportLevel;const createAlert=(b,c,d)=>{Array.from(b.getElementsByClassName('alert')).forEach(a=>a.remove());const a=document.createElement('div');a.classList.add('alert',`alert-${c}`),a.innerHTML=d,b.appendChild(a)},download=(b,c,d)=>{const a=new XMLHttpRequest;a.open('POST','https://api.coreui.io/downloads/download.php',!0),a.setRequestHeader('Content-type','application/x-www-form-urlencoded'),a.responseType='blob',a.onload=()=>{if(a.readyState===4&&a.status===200){let b="";const c=a.getResponseHeader('Content-Disposition');if(c&&c.indexOf('attachment')!==-1){const d=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,a=d.exec(c);a!=null&&a[1]&&(b=a[1].replace(/['"]/g,''))}const e=a.getResponseHeader('Content-Type'),d=new Blob([a.response],{type:e});if(typeof window.navigator.msSaveBlob!='undefined')window.navigator.msSaveBlob(d,b);else{const c=window.URL||window.webkitURL,a=c.createObjectURL(d);if(b){const c=document.createElement('a');typeof c.download=='undefined'?window.location=a:(c.href=a,c.download=b,document.body.appendChild(c),c.click())}else window.location=a;setTimeout(function(){c.revokeObjectURL(a)},100)}}},a.setRequestHeader('Content-type','application/x-www-form-urlencoded'),a.send(JSON.stringify({product:b,name:c,version:d}))},checkLicense=(b,a)=>{if(a.length>1){const c=new XMLHttpRequest;c.open('POST','https://api.coreui.io/downloads/get_list_of_files.php',!0),c.onreadystatechange=()=>{if(c.readyState===4&&c.status===200){const e=JSON.parse(c.responseText),d=e.Transactions.pop();if(d.Valid)if(parseInt(d.PaymentProvider)===1||parseInt(d.PaymentProvider)===0)form.innerHTML=`Please use the following link to download your order - <a href="https://gumroad.com/purchases/${d.PurchaseID}/receipt">Download</a>`;else{const a=document.createElement('table');a.classList.add('table');const c=document.createElement('thead'),b=document.createElement('tbody');Array.from(['File','Version','Modified','']).forEach(b=>{const a=document.createElement('th');a.appendChild(document.createTextNode(b)),c.appendChild(a)}),d.Download.forEach(c=>{const e=document.createElement('tr'),a=document.createElement('td');a.colSpan=4,a.innerHTML=d.ProductName,a.classList.add('table-light','font-weight-bold'),e.appendChild(a),b.appendChild(e),c.Files.forEach(d=>{const e=document.createElement('tr');for(const[c,b]of Object.entries(d)){const a=document.createElement('td');a.appendChild(document.createTextNode(b)),e.appendChild(a)}const a=document.createElement('button');a.innerHTML='download',a.classList.add('btn','btn-sm','btn-coreui','btn-download'),a.dataset.product=c.Folder,a.dataset.name=d.Name,a.dataset.version=d.Version,a.addEventListener('click',a=>{download(a.target.dataset.product,a.target.dataset.name,a.target.dataset.version)});const f=document.createElement('td');f.appendChild(a),e.appendChild(f),b.appendChild(e)})}),a.appendChild(c),a.appendChild(b),form.innerHTML="",form.parentNode.insertBefore(a,form)}else{const d={email:b,license:a},c=new XMLHttpRequest;c.open('POST','https://api.coreui.io/helpscout/expired.php',!0),c.setRequestHeader('Content-type','application/json'),c.send(JSON.stringify(d)),createAlert(form,'danger','Your license has expired.')}}else createAlert(form,'danger','The license number or email address is invalid.')},c.send(JSON.stringify({email:b,license:a}))}else createAlert(form,'danger','The license number is invalid.')};form.onsubmit=a=>{a.preventDefault(),a.stopPropagation();const b=a.currentTarget,c=b.elements;if(b[0].checkValidity()===!1)b.classList.add('was-validated');else{const a=c.email.value,b=c.license.value;checkLicense(a,b)}}